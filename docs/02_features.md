# タスケテ - 機能仕様書

## 概要

当日券特化型予約サービス「タスケテ 〜HELP ME!!〜」の機能一覧と詳細仕様

---

## エンドユーザー向け機能

### 1. 公演一覧表示（トップページ）

**URL:** `/`

**機能:**
- 今日以降の公演を一覧表示
- 公演日・開演時刻の昇順でソート
- 各公演カードに以下の情報を表示:
  - ポスター画像
  - 公演タイトル
  - 劇団名
  - 会場・エリア
  - 開演時刻
  - チケット価格
  - 当日券ステータスバッジ

**フィルター機能:**
- 日付フィルター: 今日/明日/週末
- エリアフィルター: 下北沢/新宿/渋谷/池袋/その他

**表示順:**
1. 公演日（昇順）
2. 開演時刻（昇順）

---

### 2. 公演詳細表示

**URL:** `/performances/{id}`

**機能:**
- 公演の詳細情報を表示:
  - ポスター画像（大）
  - 公演タイトル
  - 劇団名・劇団情報
    - 劇団説明文
    - 劇団ウェブサイトへのリンク
  - 公演説明文
  - 会場・エリア
  - 公演日・開演時刻・開場時刻
  - チケット価格
  - 当日券ステータス
  - 予約URLへのリンク（外部サイト）

**アクション:**
- 一覧に戻るボタン
- 予約サイトへ遷移ボタン（外部リンク）

---

## 管理画面機能

### 共通仕様

**認証:**
- メールアドレス・パスワードでログイン
- Laravel Sanctumでセッション管理

**権限:**
- super_admin: 全データへのアクセス可能
- theater_admin: 自劇団のデータのみアクセス可能

**レイアウト:**
- サイドバーナビゲーション
- ダッシュボード / 劇団管理 / 公演管理 / ユーザー管理

---

### 3. ログイン

**URL:** `/admin/login`

**機能:**
- メールアドレス・パスワード入力
- バリデーション
- ログイン後はダッシュボードへリダイレクト

**エラーハンドリング:**
- 認証失敗時はエラーメッセージ表示

---

### 4. ダッシュボード

**URL:** `/admin`

**機能:**
- 統計情報の表示:
  - 登録劇団数
  - 総公演数
  - 今日の公演数
  - 当日券ありの公演数
- 最近登録された公演（直近5件）

**表示制限:**
- theater_adminは自劇団のデータのみ表示

---

### 5. 劇団管理

#### 5-1. 劇団一覧

**URL:** `/admin/troupes`

**機能:**
- 劇団一覧をテーブル表示
- 表示項目:
  - 劇団名
  - 説明文（2行省略表示）
  - ウェブサイト（リンクアイコン）
  - 作成日
  - 操作ボタン（編集/削除）

**権限:**
- super_admin: 全劇団表示、新規作成・削除可能
- theater_admin: 自劇団のみ表示、編集のみ可能

**アクション:**
- 劇団を追加ボタン（super_adminのみ）
- 編集ボタン
- 削除ボタン（super_adminのみ）

#### 5-2. 劇団作成

**URL:** `/admin/troupes/create`

**権限:** super_adminのみ

**フォーム項目:**
- 劇団名（必須）
- 説明文（任意、textarea）
- ウェブサイトURL（任意、URL形式）

**バリデーション:**
- 劇団名: 必須
- ウェブサイト: URL形式チェック

**アクション:**
- 作成ボタン → 一覧へリダイレクト
- キャンセルボタン → 一覧へ戻る

#### 5-3. 劇団編集

**URL:** `/admin/troupes/{id}/edit`

**権限:**
- super_admin: 全劇団編集可能
- theater_admin: 自劇団のみ編集可能

**フォーム項目:**
- 劇団作成と同じ

**アクション:**
- 更新ボタン → 一覧へリダイレクト
- キャンセルボタン → 一覧へ戻る

---

### 6. 公演管理

#### 6-1. 公演一覧

**URL:** `/admin/performances`

**機能:**
- 公演一覧をテーブル表示
- 表示項目:
  - ポスター画像（サムネイル）
  - 公演名
  - 劇団名
  - 開演時刻（日時）
  - 当日券ステータス
  - 操作ボタン（編集/削除）

**ソート:**
- 公演日（降順）
- 開演時刻（降順）

**権限:**
- super_admin: 全公演表示
- theater_admin: 自劇団の公演のみ表示

**アクション:**
- 公演を追加ボタン
- 編集ボタン
- 削除ボタン

#### 6-2. 公演作成

**URL:** `/admin/performances/create`

**権限:**
- super_admin: 全劇団の公演作成可能
- theater_admin: 自劇団の公演のみ作成可能

**フォーム項目:**
- 劇団（必須、セレクトボックス）
  - theater_adminは自劇団固定（変更不可）
- 公演タイトル（必須）
- 公演説明（任意、textarea）
- 会場（必須）
- エリア（必須、セレクトボックス: 下北沢/新宿/渋谷/池袋/その他）
- エリア詳細（任意、「その他」選択時のみ表示）
- 公演日（必須、date）
- 開演時刻（必須、time）
- 開場時刻（任意、time）
- チケット価格（必須、number）
- 当日券販売ありフラグ（チェックボックス）
- 予約URL（任意、URL形式）
- ポスター画像（任意、画像アップロード）

**バリデーション:**
- 劇団: 必須
- 公演タイトル: 必須
- 会場: 必須
- エリア: 必須、enum
- エリア詳細: 「その他」選択時は任意、最大100文字
- 公演日: 必須、date形式
- 開演時刻: 必須、time形式
- チケット価格: 必須、0以上の整数
- 予約URL: URL形式
- ポスター画像: 画像ファイル（jpg, png, webp）

**画像アップロード:**
- 最大サイズ: 5MB
- 許可形式: jpg, png, webp
- ストレージ: public/storage/posters/

**アクション:**
- 作成ボタン → 一覧へリダイレクト
- キャンセルボタン → 一覧へ戻る

#### 6-3. 公演編集

**URL:** `/admin/performances/{id}/edit`

**権限:**
- super_admin: 全公演編集可能
- theater_admin: 自劇団の公演のみ編集可能

**フォーム項目:**
- 公演作成と同じ
- 既存のポスター画像がある場合は表示
- 画像削除ボタン

**アクション:**
- 更新ボタン → 一覧へリダイレクト
- キャンセルボタン → 一覧へ戻る

---

### 7. ユーザー管理（管理者アカウント）

**URL:** `/admin/users`

**権限:** super_adminのみ

**機能:**
- 管理者アカウント一覧表示
- 表示項目:
  - メールアドレス
  - 権限（super_admin / theater_admin）
  - 管理劇団（theater_adminの場合）
  - 作成日
  - 操作ボタン（編集/削除）

**アクション:**
- ユーザーを追加ボタン
- 編集ボタン
- 削除ボタン

#### 7-1. ユーザー作成

**権限:** super_adminのみ

**フォーム項目:**
- メールアドレス（必須、unique）
- パスワード（必須、8文字以上）
- 権限（必須、ラジオボタン: super_admin / theater_admin）
- 管理劇団（theater_adminの場合のみ必須、セレクトボックス）

**バリデーション:**
- メールアドレス: 必須、email形式、unique
- パスワード: 必須、8文字以上
- 権限: 必須、enum
- 管理劇団: theater_adminの場合は必須

**アクション:**
- 作成ボタン → 一覧へリダイレクト
- キャンセルボタン → 一覧へ戻る

---

## 共通UI仕様

### 当日券ステータスバッジ

1. **当日券あり**: 青色バッジ "当日券あり"
2. **当日券なし**: グレーバッジ "当日券なし"

**Note:** スモールスタートのため、残券数管理は行わず当日券の有無のみを表示します。将来的に予約システムを実装する際に、詳細な在庫表示機能を追加することを想定しています。

### エラーハンドリング

- フォームバリデーションエラーは各フィールド下に表示
- サーバーエラーはフォーム上部に表示
- 成功メッセージはトースト通知で表示

### レスポンシブデザイン

- モバイル: 768px以下
- タブレット: 768px〜1024px
- デスクトップ: 1024px以上

---

## 技術要件

### フロントエンド
- Vue 3 (Composition API)
- Inertia.js (Laravel統合)
- Tailwind CSS
- UIライブラリ: PrimeVue / Element Plus / Vuetify

### バックエンド
- Laravel 11.x
- Laravel Sanctum (認証)
- Laravel Policies (認可)
- 画像処理: Intervention Image

### データベース
- MySQL 8.x または PostgreSQL 14.x

### ストレージ
- 画像: public/storage/posters/
- Laravelのシンボリックリンク設定

---

生成日: 2025-12-24
